var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,c=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&o(e,a,t[a]);if(n)for(var a of n(t))l.call(t,a)&&o(e,a,t[a]);return e},s=(e,n)=>t(e,a(n));import{R as i,C as m,u as d,a as u,m as g,c as p,b as f,d as E,T as y,e as S,S as b,G as h,B as v,v as w,f as k,g as O,h as I,i as C,t as F,r as j,j as L,I as P,A as U,k as x,D as R,l as $,n as B,o as M,p as D,q as T,s as N,w as _,P as z,x as A,y as q,z as G}from"./vendor.92ad98cd.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,l)=>{const o=new URL(e,n);if(self[t].moduleMap[o])return a(self[t].moduleMap[o]);const c=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){l(new Error(`Failed to import: ${e}`)),r(s)},onload(){a(self[t].moduleMap[o]),r(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/assets/");const W=e=>{const[t,a]=i.useState(!1);return i.createElement(m,{style:{width:"100%",height:"100%"},onMouseOver:()=>{a(!0)},onMouseOut:()=>{a(!1)},raised:t},e.children)},H=()=>{const{enqueueSnackbar:e}=d();return{inherit:t=>{e(t,{variant:"default"})},success:t=>{e(t,{variant:"success"})},err:t=>{e(t,{variant:"error"})},warn:t=>{e(t,{variant:"warning"})},info:t=>{e(t,{variant:"info"})}}};let J="";var K=e=>{J=`bearer ${e}`},Q=async e=>(await u.get(`/api/signService/signaStudentById/${e}`,{headers:{Authorization:J}})).data.id,V=async e=>(await u.get(`/api/signService/unsignaStudentById/${e}`,{headers:{Authorization:J}})).data.id;const X=g((e=>p({roomSigned:{backgroundColor:e.palette.primary.main},roomPartSigned:{backgroundColor:e.palette.primary.light},roomFullUnSigned:{backgroundColor:e.palette.secondary.main}}))),Y=({room:e})=>{const t=X(),[a,n]=i.useState(t.roomFullUnSigned),r=f((e=>e.student));return i.useEffect((()=>{const a=e.peoples.map((e=>!!r.includes(e.id)));a.includes(!1)?a.includes(!0)?n(t.roomPartSigned):n(t.roomFullUnSigned):n(t.roomSigned)}),[r]),i.createElement(i.Fragment,null,i.createElement(W,null,i.createElement(E,{className:a},i.createElement(y,{variant:"h5",align:"center",style:{color:"#fff"}},e.code),i.createElement(Z,{peoples:e.peoples}))))},Z=({peoples:e})=>{const t=S(),a=f((e=>e.student)),n=H();return i.createElement(b,{container:!0,direction:"column",spacing:1},e.map(((e,r)=>i.createElement(b,{item:!0,key:e.id},i.createElement(h,{in:!0,timeout:350*r},i.createElement(v,{color:a.includes(e.id)?"primary":"secondary",style:{width:76.4,paddingLeft:0,paddingRight:0},variant:"contained",onClick:r=>{if(r.preventDefault(),!localStorage.getItem("token"))return n.err("未登录，点击右上角登录");var l;a.includes(e.id)?t((l=e.id,async e=>{K(localStorage.getItem("token")),e({type:"unSignaStudent",data:await V(l)})})):t((e=>async t=>{K(localStorage.getItem("token")),t({type:"signaStudent",data:await Q(e)})})(e.id))}},e.name))))))},ee=({rooms:e})=>i.createElement(W,null,i.createElement(E,null,i.createElement(b,{container:!0,direction:"row",spacing:1,justify:"center",alignItems:"flex-start"},e.map((e=>i.createElement(b,{item:!0,key:w()},i.createElement(Y,{room:e}))))))),te=({places:e})=>i.createElement(i.Fragment,null,e.map((e=>i.createElement(ae,{place:e,key:e.name})))),ae=({place:e})=>i.createElement(i.Fragment,null,i.createElement(y,{variant:"h4",align:"center"},e.name),i.createElement(ee,{rooms:e.rooms}));var ne=async e=>{const{data:t}=await u.get(`/api/getInf/getGroupStatByName/${e}`);return t};const re=({groups:e})=>{const t=S();return i.useEffect((()=>{t((async e=>{e({type:"initStudents",data:(await u.get("/api/getSignedStudents")).data})}))}),[]),i.createElement(i.Fragment,null,e.map((e=>i.createElement(le,{group:e,key:e.name}))))},le=({group:e})=>{const[t,a]=i.useState({name:"",signed:0,total:0});return i.useEffect((()=>{ne(e.name).then((e=>{a(e)}))}),[]),i.createElement(i.Fragment,null,i.createElement(y,{variant:"h3",align:"center",style:{marginTop:8}},e.name),i.createElement(y,{variant:"h6",align:"center"},"签到数：",t.signed,"/",t.total),i.createElement(te,{places:e.places}))},oe=e=>({type:"changePassword",data:e}),ce=O(k({student:(e=[],t)=>{switch(t.type){case"signaStudent":return e.concat(t.data);case"unSignaStudent":return((e,t)=>{const a=e.indexOf(t);return[...e.slice(0,a),...e.slice(a+1,e.length)]})(e,t.data);case"initStudents":return t.data;default:return e}},user:(e={username:"root",password:null},t)=>{switch(t.type){case"changeUsername":return s(c({},e),{username:t.data});case"changePassword":return s(c({},e),{password:t.data});default:return e}}}),I(C(F)));var se={palette:{common:{black:"#000",white:"#fff"},background:{paper:"#fff",default:"#fafafa"},primary:{light:"rgba(128, 226, 126, 1)",main:"rgba(76, 175, 80, 1)",dark:"rgba(8, 127, 35, 1)",contrastText:"#fff"},secondary:{light:"rgba(255, 121, 96, 1)",main:"rgba(244, 67, 53, 1)",dark:"rgba(185, 0, 11, 1)",contrastText:"#fff"},error:{light:"#e57373",main:"#f44336",dark:"#d32f2f",contrastText:"#fff"},text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.54)",disabled:"rgba(0, 0, 0, 0.38)",hint:"rgba(0, 0, 0, 0.38)"}}};const ie=g((e=>({loginIconStyle:{position:"fixed",right:0},red:{color:"#fff",backgroundColor:j[500]},green:{color:"#fff",backgroundColor:L[500]}}))),me=()=>{const e=ie(),[t,a]=i.useState(!1),[n,r]=i.useState(!1),[l,o]=i.useState(!1);i.useEffect((()=>{localStorage.getItem("token")&&o(!0)}),[]);return i.createElement(i.Fragment,null,i.createElement(P,{className:e.loginIconStyle,onClick:e=>{e.preventDefault(),l?r(!0):a(!0)}},i.createElement(U,{className:l?e.green:e.red},i.createElement(x,null))),i.createElement(de,{open:t,setOpen:a,setLoggedin:o}),i.createElement(ue,{open:n,setOpen:r,setLoggedin:o}))},de=({open:e,setOpen:t,setLoggedin:a})=>{const n=S(),r=f((e=>e.user)),l=H();return i.createElement("div",null,i.createElement(R,{open:e,"aria-labelledby":"form-dialog-title"},i.createElement($,{id:"form-dialog-title"},"登录"),i.createElement(B,null,i.createElement(M,null,"你把你密码给我交了"),i.createElement(D,{autoFocus:!0,margin:"dense",id:"name",label:"密码",type:"password",fullWidth:!0,onChange:e=>{n(oe(e.target.value))},style:{color:"#1976d2"}})),i.createElement(T,null,i.createElement(v,{onClick:async()=>{t(!1);try{const e=await u.post("/api/login",{password:r.password});n({type:"changeUsername",data:e.data.user}),localStorage.setItem("token",e.data.token),a(!0),l.success("登录成功")}catch(e){console.error(e.message),l.err("登录失败，请检查密码")}},color:"primary"},"确定"))))},ue=({open:e,setOpen:t,setLoggedin:a})=>{const n=S(),r=async()=>{t(!1)};return i.createElement("div",null,i.createElement(R,{open:e,onClose:r,"aria-labelledby":"form-dialog-title"},i.createElement($,{id:"form-dialog-title"},"注销"),i.createElement(B,null,i.createElement(M,null,"当真退出登录？")),i.createElement(T,null,i.createElement(v,{onClick:r,color:"primary"},"取消"),i.createElement(v,{onClick:async()=>{t(!1),n(oe("")),localStorage.removeItem("token"),a(!1)},color:"secondary"},"确定"))))},ge=({children:e})=>{const t=i.createRef(),a=e=>()=>{t.current.closeSnackbar(e)};return i.createElement(N,{maxSnack:4,preventDuplicate:!0,ref:t,action:e=>i.createElement(v,{onClick:a(e),style:{color:"#FFF"}},"关闭")},e)},pe=()=>{const e=_(se),[t,a]=i.useState([]);return i.useEffect((()=>{u.get("/api/getInf/getStudentsByRoom").then((e=>{a(e.data)}))}),[]),i.createElement(z,{store:ce},i.createElement(A,{theme:e},i.createElement(ge,null,i.createElement(me,null),i.createElement(q,null,i.createElement(re,{groups:t})))))};G.render(i.createElement(pe,null),document.getElementById("root"));
